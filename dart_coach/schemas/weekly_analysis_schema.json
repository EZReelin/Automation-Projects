{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "weekly_analysis_schema",
  "title": "Weekly Analysis Report Schema",
  "description": "Schema for aggregated weekly performance analysis generated by Ollama",
  "type": "object",
  "required": ["report_id", "generated_at", "week_period", "data_sources_included", "analysis"],
  "properties": {
    "report_id": {
      "type": "string",
      "description": "Unique identifier for this report",
      "pattern": "^report_[0-9]{8}$"
    },
    "generated_at": {
      "type": "string",
      "format": "date-time"
    },
    "week_period": {
      "type": "object",
      "required": ["start_date", "end_date"],
      "properties": {
        "start_date": {"type": "string", "format": "date"},
        "end_date": {"type": "string", "format": "date"},
        "week_number": {"type": "integer"}
      }
    },
    "data_sources_included": {
      "type": "object",
      "properties": {
        "scolia_sessions": {"type": "integer"},
        "dart_connect_matches": {"type": "integer"},
        "biomechanics_sessions": {"type": "integer"},
        "voice_observations": {"type": "integer"}
      }
    },
    "practice_summary": {
      "type": "object",
      "description": "Summary of practice data from Scolia",
      "properties": {
        "total_practice_time_minutes": {"type": "number"},
        "total_darts_thrown": {"type": "integer"},
        "sessions_count": {"type": "integer"},
        "average_session_duration": {"type": "number"},
        "metrics": {
          "type": "object",
          "properties": {
            "average_ppd": {"type": "number"},
            "average_three_dart": {"type": "number"},
            "best_three_dart": {"type": "number"},
            "average_checkout_pct": {"type": "number"},
            "best_checkout_pct": {"type": "number"},
            "total_180s": {"type": "integer"},
            "total_ton_plus": {"type": "integer"}
          }
        },
        "cpu_matches": {
          "type": "object",
          "properties": {
            "played": {"type": "integer"},
            "won": {"type": "integer"},
            "win_rate": {"type": "number"}
          }
        },
        "online_matches": {
          "type": "object",
          "properties": {
            "played": {"type": "integer"},
            "won": {"type": "integer"},
            "win_rate": {"type": "number"}
          }
        }
      }
    },
    "competition_summary": {
      "type": "object",
      "description": "Summary of competitive data from Dart Connect",
      "properties": {
        "total_matches": {"type": "integer"},
        "matches_won": {"type": "integer"},
        "matches_lost": {"type": "integer"},
        "win_rate": {"type": "number"},
        "legs_won": {"type": "integer"},
        "legs_lost": {"type": "integer"},
        "leg_win_rate": {"type": "number"},
        "metrics": {
          "type": "object",
          "properties": {
            "average_ppd": {"type": "number"},
            "average_three_dart": {"type": "number"},
            "best_match_average": {"type": "number"},
            "average_checkout_pct": {"type": "number"},
            "total_180s": {"type": "integer"},
            "highest_checkout": {"type": "integer"}
          }
        },
        "pressure_performance": {
          "type": "object",
          "properties": {
            "match_darts_conversion_rate": {"type": "number"},
            "deciding_legs_won": {"type": "integer"},
            "deciding_legs_played": {"type": "integer"}
          }
        },
        "venue_breakdown": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "venue": {"type": "string"},
              "matches": {"type": "integer"},
              "win_rate": {"type": "number"}
            }
          }
        }
      }
    },
    "practice_vs_competition_comparison": {
      "type": "object",
      "description": "Comparison between practice and competitive performance",
      "properties": {
        "average_difference": {
          "type": "number",
          "description": "Practice average minus competition average"
        },
        "checkout_difference": {
          "type": "number"
        },
        "insights": {
          "type": "array",
          "items": {"type": "string"}
        }
      }
    },
    "biomechanics_summary": {
      "type": "object",
      "properties": {
        "sessions_analyzed": {"type": "integer"},
        "throws_analyzed": {"type": "integer"},
        "average_consistency_score": {"type": "number"},
        "consistency_trend": {
          "type": "string",
          "enum": ["improving", "stable", "declining"]
        },
        "most_common_issues": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "issue": {"type": "string"},
              "frequency": {"type": "integer"},
              "recommendation": {"type": "string"}
            }
          }
        },
        "form_improvements": {
          "type": "array",
          "items": {"type": "string"}
        }
      }
    },
    "observation_summary": {
      "type": "object",
      "properties": {
        "total_observations": {"type": "integer"},
        "key_themes": {
          "type": "array",
          "items": {"type": "string"}
        },
        "mental_state_trends": {
          "type": "object",
          "properties": {
            "overall_sentiment": {"type": "string"},
            "confidence_mentions": {"type": "integer"},
            "frustration_mentions": {"type": "integer"},
            "focus_mentions": {"type": "integer"}
          }
        },
        "technique_feedback": {
          "type": "array",
          "items": {"type": "string"}
        }
      }
    },
    "analysis": {
      "type": "object",
      "required": ["executive_summary", "key_findings", "recommendations"],
      "properties": {
        "executive_summary": {
          "type": "string",
          "description": "Brief overview of the week's performance"
        },
        "key_findings": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "finding": {"type": "string"},
              "category": {
                "type": "string",
                "enum": ["strength", "weakness", "trend", "observation"]
              },
              "supporting_data": {"type": "string"}
            }
          }
        },
        "trends": {
          "type": "object",
          "properties": {
            "scoring": {
              "type": "string",
              "enum": ["improving", "stable", "declining"]
            },
            "checkout": {
              "type": "string",
              "enum": ["improving", "stable", "declining"]
            },
            "consistency": {
              "type": "string",
              "enum": ["improving", "stable", "declining"]
            },
            "mental_game": {
              "type": "string",
              "enum": ["improving", "stable", "declining"]
            }
          }
        },
        "week_over_week_comparison": {
          "type": "object",
          "properties": {
            "average_change": {"type": "number"},
            "checkout_change": {"type": "number"},
            "win_rate_change": {"type": "number"},
            "notable_changes": {
              "type": "array",
              "items": {"type": "string"}
            }
          }
        },
        "recommendations": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "area": {"type": "string"},
              "recommendation": {"type": "string"},
              "priority": {
                "type": "string",
                "enum": ["high", "medium", "low"]
              },
              "specific_drills": {
                "type": "array",
                "items": {"type": "string"}
              }
            }
          }
        },
        "practice_plan": {
          "type": "object",
          "description": "Suggested practice plan for the coming week",
          "properties": {
            "focus_areas": {
              "type": "array",
              "items": {"type": "string"}
            },
            "suggested_sessions": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "type": {"type": "string"},
                  "duration_minutes": {"type": "integer"},
                  "focus": {"type": "string"},
                  "drills": {
                    "type": "array",
                    "items": {"type": "string"}
                  }
                }
              }
            },
            "mental_exercises": {
              "type": "array",
              "items": {"type": "string"}
            }
          }
        },
        "goals_for_next_week": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "goal": {"type": "string"},
              "metric": {"type": "string"},
              "target": {"type": "string"}
            }
          }
        }
      }
    },
    "raw_data_references": {
      "type": "object",
      "description": "References to source data files",
      "properties": {
        "scolia_files": {
          "type": "array",
          "items": {"type": "string"}
        },
        "dart_connect_files": {
          "type": "array",
          "items": {"type": "string"}
        },
        "biomechanics_files": {
          "type": "array",
          "items": {"type": "string"}
        },
        "voice_files": {
          "type": "array",
          "items": {"type": "string"}
        }
      }
    }
  }
}
